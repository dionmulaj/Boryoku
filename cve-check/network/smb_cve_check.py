PORTS = [445]

CVE_MAPPINGS = {
    "Windows 7": "MS17-010 (EternalBlue)",
    "Windows Server 2008": "MS17-010 (EternalBlue)",
    "Windows XP": "MS08-067",
    "Windows Server 2012": "CVE-2017-0143",
    "Windows 8": "CVE-2017-0144",
    "Windows Vista": "CVE-2008-4037",
    "Windows Server 2003": "CVE-2003-0813",
    "Windows 2000": "CVE-2000-1200",
    "Windows Server 2016": "CVE-2017-0145",
    "Windows 10": "CVE-2017-0146",
    "Windows Server 2019": "CVE-2019-0708 (BlueKeep)",
    "Windows Server 2008 R2": "CVE-2017-0144",
    "Windows 8.1": "CVE-2017-0145",
    "Windows Server 2012 R2": "CVE-2017-0146",
    "Windows Server 2016 Datacenter": "CVE-2017-0143",
    "Windows Server 2016 Essentials": "CVE-2017-0144",
    "Windows Server 2016 Standard": "CVE-2017-0145",
    "Windows Server 2019 Datacenter": "CVE-2019-0708",
    "Windows Server 2019 Essentials": "CVE-2019-0708",
    "Windows Server 2019 Standard": "CVE-2019-0708"
}

def run(host, results):
    from impacket.smbconnection import SMBConnection
    try:
        smb = SMBConnection(host, host, sess_port=445, timeout=5)
        smb.login('', '')
        version = smb.getServerOS()
        cve = None
        for key, val in CVE_MAPPINGS.items():
            if key in version:
                cve = val
                break
            if cve:
                results[host].setdefault("CVE-CHECK", []).append(f"Potential CVE detected: {cve} via SMB version: {version}")
        smb.close()
    except Exception:
        pass  
