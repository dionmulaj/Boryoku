PORTS = [3389]

CVE_MAPPINGS = {
    "5.1.2600": "CVE-2019-0708 (BlueKeep)",
    "6.0.6001": "CVE-2012-0152",
    "5.2.3790": "CVE-2003-0813",
    "6.1.7601": "CVE-2012-0002",
    "6.3.9600": "CVE-2014-6316",
    "10.0.14393": "CVE-2016-0126",
    "6.2.9200": "CVE-2013-1296",
    "5.1.2600.2180": "CVE-2006-0003",
    "6.0.6002": "CVE-2010-0026",
    "5.2.3790.1830": "CVE-2005-0069",
    "6.1.7600": "CVE-2010-0026",
    "6.2.9200.16384": "CVE-2013-1296",
    "10.0.10240": "CVE-2015-2373",
    "10.0.10586": "CVE-2016-0126",
    "10.0.15063": "CVE-2017-0176",
    "10.0.16299": "CVE-2018-0886",
    "10.0.17134": "CVE-2018-0976",
    "10.0.17763": "CVE-2019-0708",
    "10.0.18362": "CVE-2019-1181",
    "10.0.19041": "CVE-2020-0609"
}

def run(host, results):
    import socket
    try:
        s = socket.socket()
        s.settimeout(5)
        s.connect((host, 3389))
        banner = s.recv(1024).decode(errors='ignore')
        cve = None
        for key, val in CVE_MAPPINGS.items():
            if key in banner:
                cve = val
                break
            if cve:
                results[host].setdefault("CVE-CHECK", []).append(f"Potential CVE detected: {cve} via RDP banner: {banner.strip()}")
        s.close()
    except Exception:
        pass  
